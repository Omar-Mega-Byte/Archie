# Application Configuration Example - TEST PROFILE
# 
# This profile is optimized for running automated tests.
# Uses H2 in-memory database with optimized settings for test execution.
#
# Activate this profile with:
# - export SPRING_PROFILES_ACTIVE=test
# - Or: mvn test -Dspring-boot.run.arguments="--spring.profiles.active=test"
# - Or configure in test properties
#
# For the actual configuration, copy this file to application-test.yml

spring:
  application:
    name: archie-blueprint-to-boot

  # Database Configuration - H2 in-memory for fast tests
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password: 
    hikari:
      maximum-pool-size: 2
      minimum-idle: 1
      connection-timeout: 10000

  jpa:
    hibernate:
      ddl-auto: create-drop  # Recreate schema for each test
    show-sql: false         # Less noise in test output
    properties:
      hibernate:
        format_sql: false
        dialect: org.hibernate.dialect.H2Dialect
        jdbc:
          batch_size: 20
          fetch_size: 50

  # H2 Console - Disabled in tests
  h2:
    console:
      enabled: false

  # File Upload Configuration - Minimal for tests
  servlet:
    multipart:
      max-file-size: 5MB
      max-request-size: 5MB
      enabled: true

  # Spring AI Configuration - Minimal for tests
  ai:
    openai:
      api-key: ${GEMINI_API_KEY:test-key}
      base-url: https://generativelanguage.googleapis.com/v1beta/openai
      chat:
        options:
          model: gemini-2.0-flash
          temperature: 0.3
          max-tokens: 1024

  # Disable unnecessary auto-configurations in tests
  test:
    database:
      replace: any

# JWT Configuration - Test values
jwt:
  secret: test-secret-key-for-testing-only
  access-token-expiration-ms: 3600000      # 1 hour
  refresh-token-expiration-ms: 604800000   # 7 days

# Google Gemini API Configuration
gemini:
  api:
    key: test-api-key
  model: gemini-2.0-flash

# Thymeleaf Configuration
thymeleaf:
  cache: true              # Cache enabled for test consistency
  prefix: classpath:/templates/
  suffix: .html

# Application Configuration
archie:
  upload:
    directory: ${java.io.tmpdir}/archie-test-uploads
  generation:
    base-package: com.test.generated
    output-directory: ${java.io.tmpdir}/archie-test-projects

# Actuator Configuration - Minimal for tests
management:
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: when-authorized

# Logging Configuration - Minimal for tests
logging:
  level:
    root: WARN
    com.archie: INFO
    org.springframework.test: INFO
    org.springframework.security: WARN

# Server Configuration
server:
  port: 0  # Random port for tests
  error:
    include-message: always
    include-binding-errors: always

# OpenAPI / Swagger Configuration
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    enabled: false   # Disable Swagger UI in tests

# Disable DevTools in tests
spring:
  devtools:
    restart:
      enabled: false
    livereload:
      enabled: false
